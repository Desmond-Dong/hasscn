import{statSync as o,writeFileSync as l,mkdirSync as u}from"node:fs";import{dirname as m,isAbsolute as p}from"node:path";const d=t=>{let r="<url>";for(const[i,e]of Object.entries(t))r+=`<${i}>${e}</${i}>`;return r+="</url>",r},c=t=>(console.log(`Generate sitemap.xml for ${t.length} pages.`),`<?xml version="1.0" encoding="UTF-8"?><urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">${t.reduce((r,i)=>r+d(i),"")}</urlset>`);function f(t){t={domain:"https://rspress.dev",customMaps:{},defaultChangeFreq:"monthly",defaultPriority:"0.5",...t};let r=[],i=new Set;return{name:"rspress-plugin-sitemap",config(e){return e},extendPageData(e,s){s&&(i.has(e.routePath)||(i.add(e.routePath),r.push({loc:`${t.domain}${e.routePath}`,lastmod:o(e._filepath).mtime.toISOString(),priority:e.routePath==="/"?"1.0":t.defaultPriority,changefreq:t.defaultChangeFreq,...t.customMaps&&t.customMaps[e.routePath]||{}})))},afterBuild(e,s){if(s){const a=e.outDir||e.builderConfig?.output?.distPath?.root;let n=`./${a||"doc_build"}/sitemap.xml`;p(a||"")&&(n=`${a}/sitemap.xml`),u(m(n),{recursive:!0}),l(n,c(r))}}}}export{f as default};
